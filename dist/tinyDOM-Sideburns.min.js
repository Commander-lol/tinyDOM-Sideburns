(function(window,undefined){"use strict";var globalOptions={ignoreUndefined:!1,escape:"general",escapeSets:{xml:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},general:{'"':'\\"',"'":"\\'"}}},deepMergeJson=function(e,n){var t;for(t in n)n.hasOwnProperty(t)&&(e[t]="object"==typeof e[t]&&"object"==typeof n[t]?deepMergeJson(e[t],n[t]):n[t]);return e},setDeepProperty=function(e,n,t,r){var a,o=function(e,n,t){var i;if(e.length>1){if(i=a.shift(),!t.hasOwnProperty(i)){if(!r)throw new Error("No internal property "+i+" at depth N - "+a.length);t[i]={}}o(e,n,t[i])}else t[e[0]]=n};return a=e.push||e.map?e:e.split(".").map(function(e){return e.trim()}),o(a,n,t),t},getDeepProperty=function(e,n){var t,r=null,a=function(n,o){var i;if(n.length>1){if(!o.hasOwnProperty(n[0]))throw i=n.reduce(function(e,n,t){return e+(t>0?".":"")+n}),new Error('Invalid proprty, missing expected data "'+i+'" (IDENT: '+e+") from data "+JSON.stringify(o));a(n,o[t.shift()])}else{if(!o.hasOwnProperty(n[0]))throw new Error('Invalid proprty, missing expected data "'+n[0]+'" (IDENT: '+e+") from data "+JSON.stringify(o));r=o[n[0]]}};return t=e.push||e.map?e:e.split(".").map(function(e){return e.trim()}),a(t,n),r},getDeepPropertyOrUndef=function(e,n){var t;try{t=getDeepProperty(e,n)}catch(r){t=void 0}return t},safeDeepMergeJson=function(e,n){if("object"!=typeof e)throw new TypeError("Cannot deep merge with an "+typeof e+": [Param 1]");if("object"!=typeof n)throw new TypeError("Cannot deep merge with an "+typeof n+": [Param 2]");return deepMergeJson(deepMergeJson({},e),n)},escapeRegex=function(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},escapeData=function(e,n){var t;for(t in n)n.hasOwnProperty(t)&&(e=String(e).split(t).join(n[t]));return e},captureTags=/(\[\[)(\#|\/)?\s*(?:([a-zA-Z]+[a-zA-Z0-9]*)\s*\:\s*([a-zA-Z]+[a-zA-Z0-9]*)|([\*\&\>\?]?)\s*((?:\!(?:\(([a-zA-Z]+[a-zA-Z0-9]*)\))?)?)\s*([a-zA-Z](?:[a-zA-Z0-9]*(?:\.(?=[a-zA-Z]))?)+))\s*(\]\])/,Node=function(e,n,t){return this.ident=e||"N_NULL",this.val=n||null,this.content=t||{},this},Token=function(e,n,t){return this.ident=e||"T_NULL",this.val=n||null,this.info=t||{},this},tokenise=function(e){var n,t,r,a=[],o=0,i=null;for(n=function(){return null!==(i=captureTags.exec(t))};o<e.length;)if(t=e.substr(o),n()){if(i.index>0&&a.push(new Token("STRING",i.input.substr(0,i.index))),r=new Token("T_NULL",null,{close:!1,escape:!1,escapeType:null}),"#"===i[2])r.ident="T_DIRECTIVE",r.val={key:i[3],value:i[4]};else{switch("/"===i[2]&&(r.info.close=!0),i[5]){case"*":r.ident="T_LOOP";break;case"&":r.ident="T_BLOCK";break;case">":r.ident="T_IMPORT";break;case"?":r.ident="T_CONDITION";break;default:r.ident="T_DATA"}"undefined"!=typeof i[6]&&"!"===i[6].charAt(0)&&(r.info.escape=!0,"undefined"!=typeof i[7]&&(r.info.escapeType=i[7])),r.val=i[8]}a.push(r),o+=i.index+i[0].length}else a.push(new Token("STRING",t)),o+=t.length;return a.push(new Token("EOD")),a},collapseParse=function(e){for(var n,t,r,a,o,i=0;i<e.length;)if(e[i].info&&e[i].info.close){for(n=[],r=e[i],t=i-1;e[t].ident!==r.ident||e[t].val!==r.val;)if(n.push(e[t]),t-=1,0>t)throw new Error("Unmatched Closing Tag "+a+" at index "+i);switch(r.ident){case"T_LOOP":case"T_BLOCK":case"T_CONDITION":o="N"+r.ident.slice(1);break;default:throw new Error("Invalid block element "+r.ident+" at index "+i)}a=new Node(o,r.val,n.slice().reverse()),e.splice(t,i-t+1,a),i=0}else i+=1;return e},unwindNode=function(e,n,t,r){var a,o,i,s,u,l,p,d,c;switch(n.ident){case"STRING":return e+n.val;case"T_DIRECTIVE":return setDeepProperty(n.val.key,n.val.value,r.opts,!0),e;case"T_DATA":return u=n.val,r.loopTag&&n.val===r.loopTag.slice(0,-1)&&(u=r.loopTag+"."+r.i.toString()),l=getDeepProperty(u,r.data),n.info.escape&&(p=n.info.escapeType?n.info.escapeType:r.opts.escape,l=escapeData(l,r.opts.escapeSets[p])),e+l;case"T_IMPORT":if(i=r.includes[n.val],"undefined"!=typeof i&&null!==i)l=i(r.data,r.opts);else{if(!r.opts.ignoreUndefined)throw new Error("Cannot get include "+n.val);l=""}return e+l;case"N_LOOP":for(i="",a=n.content,a.data=r.data,a.loopTag=n.val,a.includes=r.includes,a.opts=deepMergeJson({},r.opts),o=getDeepProperty(n.val,r.data),s=0;s<o.length;s+=1)a.i=s,i+=a.reduce(unwindNode,"");return e+i;case"N_BLOCK":return a=n.content,a.data=getDeepProperty(n.val,r.data),a.loopTag=null,a.includes=r.includes,a.opts=deepMergeJson({},r.opts),e+a.reduce(unwindNode,"");case"N_CONDITION":return c=getDeepPropertyOrUndef(n.val,r.opts),c?(a=n.content,a.data=r.data,a.loopTag=null,a.includes=r.includes,a.opts=deepMergeJson({},r.opts),d=a.reduce(unwindNode,"")):d="",e+d;default:return e}},render=function(e,n,t){var r=collapseParse(tokenise(e));return r.data=n,r.loopTag=null,r.i=null,r.includes=render.includes,r.opts=safeDeepMergeJson(globalOptions,t),r.reduce(unwindNode,"")};if(render.partial=function(e){return function(e,n,t){return e.data=n,e.loopTag=null,e.i=null,e.includes=render.includes,e.opts=safeDeepMergeJson(globalOptions,t),e.reduce(unwindNode,"")}.bind(null,collapseParse(tokenise(e)))},render.includes={},render.addInclude=function(e,n){this.includes[e]=n.split?render.partial(n):n},!window.mu)throw new Error("tinyDOM-Sideburns requires tinyDOM to be in use on the page");mu.templates={},mu.render=function(e,n,t){return render.includes.hasOwnProperty(e)?render.includes[e](n,t):render(e,n,t)},mu.include=function(e,n){render.addInclude(e,n)},mu.partial=render.partial,mu.fn.render=function(e,n,t){var r=mu.render(e,n,t),a=t||{useHtml:!0};"undefined"==typeof a.useHtml&&(a.useHtml=!0),this.each(function(e,n){a.useHtml?n.innerHTML=r:n.textContent=r})},mu.ready(function(){mu("[type='x-template/sideburns']").each(function(e,n){var t=n.getAttribute("data-name");render.addInclude(t,n.textContent)})});})(window);
//# sourceMappingURL=tinyDOM-Sideburns.min.js.map
